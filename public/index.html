<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAGI System v4.0</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: #f5f5f5; }
        .container { display: flex; height: 100vh; }
        .sidebar { width: 250px; background: #2c3e50; color: white; padding: 20px; }
        .menu-title { font-size: 18px; font-weight: bold; margin-bottom: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .menu-item { padding: 12px; margin: 8px 0; background: #34495e; border-radius: 4px; cursor: pointer; }
        .menu-item:hover { background: #3498db; }
        .menu-item.active { background: #3498db; }
        .content { flex: 1; padding: 30px; overflow-y: auto; background: white; }
        .page { display: none; }
        .page.active { display: block; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #2980b9; }
        .result { margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- サイドバー -->
        <div class="sidebar">
            <div class="menu-title">≡ MAGI v4.0</div>
            <div class="menu-item active" onclick="switchPage('qa')">質問応答</div>
            <div class="menu-item" onclick="switchPage('analysis')">銘柄分析</div>
            <div class="menu-item" onclick="switchPage('document')">文書解析</div>
            <div class="menu-item" onclick="switchPage('history')">履歴</div>
            <div class="menu-item" onclick="switchPage('settings')">設定</div>
        </div>

        <!-- コンテンツ -->
        <div class="content">
            <!-- 質問応答 -->
            <div class="page active" id="qa">
                <h2>質問応答</h2>
                <div class="form-group">
                    <label>質問</label>
                    <textarea id="question" placeholder="質問を入力..." rows="4"></textarea>
                </div>
                <button onclick="submitQuestion()">送信</button>
                <div class="result" id="qaResult"></div>
            </div>

            <!-- 銘柄分析 -->
            <div class="page" id="analysis">
                <h2>銘柄分析</h2>
                <div class="form-group">
                    <label>シンボル</label>
                    <input type="text" id="symbol" placeholder="例: AAPL" value="AAPL">
                </div>
                <button onclick="analyzeStock()">分析</button>
                <div class="result" id="analysisResult"></div>
            </div>

            <!-- 文書解析 -->
            <div class="page" id="document">
                <h2>文書解析</h2>
                <div class="form-group">
                    <label>テキスト</label>
                    <textarea id="docText" placeholder="テキストを入力..." rows="6"></textarea>
                </div>
                <button onclick="analyzeSentiment()">分析</button>
                <div class="result" id="docResult"></div>
            </div>

            <!-- 履歴 -->
            <div class="page" id="history">
                <h2>履歴</h2>
                <div id="historyList"></div>
            </div>

            <!-- 設定 -->
            <div class="page" id="settings">
                <h2>設定</h2>
                <div class="form-group">
                    <label>API URL</label>
                    <input type="text" id="apiUrl" value="http://localhost:8888">
                </div>
                <button onclick="saveSettings()">保存</button>
            </div>
        </div>
    </div>

    <script>
        const history = [];
        let apiUrl = 'http://localhost:8888';

        // ページ切り替え
        function switchPage(pageId) {
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(pageId).classList.add('active');
            updateHistory();
        }

        // 銘柄分析
        async function analyzeStock() {
            const symbol = document.getElementById('symbol').value;
            if (!symbol) { alert('シンボルを入力してください'); return; }
            
            const result = document.getElementById('analysisResult');
            result.innerHTML = '処理中...';
            
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ symbol })
                });
                const json = await response.json();
                
                if (json.success) {
                    const d = json.data;
                    result.innerHTML = `
                        <h3>${d.symbol} 分析結果</h3>
                        <p><strong>企業:</strong> ${d.company}</p>
                        <p><strong>推奨:</strong> ${d.consensus.recommendation}</p>
                        <p><strong>信頼度:</strong> ${(d.consensus.confidence * 100).toFixed(1)}%</p>
                    `;
                    history.push({ type: '銘柄分析', symbol, timestamp: new Date() });
                } else {
                    result.innerHTML = `<p>エラー: ${json.error}</p>`;
                }
            } catch (error) {
                result.innerHTML = `<p>エラー: ${error.message}</p>`;
            }
        }

        // 履歴更新
        function updateHistory() {
            const list = document.getElementById('historyList');
            if (history.length === 0) {
                list.innerHTML = '<p>まだ履歴がありません。</p>';
                return;
            }
            list.innerHTML = history.map(h => `
                <div style="padding: 12px; background: #f8f9fa; border-radius: 4px; margin-bottom: 8px;">
                    <strong>${h.type}</strong> - ${new Date(h.timestamp).toLocaleString('ja-JP')}
                    ${h.symbol ? `<br><small>銘柄: ${h.symbol}</small>` : ''}
                </div>
            `).reverse().join('');
        }

        // 設定保存
        function saveSettings() {
            apiUrl = document.getElementById('apiUrl').value;
            alert('設定を保存しました');
        }

        function submitQuestion() {
            alert('質問応答機能は準備中です');
        }

        function analyzeSentiment() {
            alert('文書解析機能は準備中です');
        }
    </script>
</body>
</html>
